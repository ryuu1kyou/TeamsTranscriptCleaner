# TeamsTranscriptCleaner

## 概要

Microsoft Teams の自動生成トランスクリプト（議事録）は、しばしば漏字・脱字や誤字が含まれます。本ツール「TeamsTranscriptCleaner」は、アップロードされた議事録テキストと誤字脱字一覧（CSV）をもとに、OpenAI API を活用して高精度な訂正を行う Web アプリケーションです。主な目的は、会議記録の品質向上と、訂正作業の効率化です。

---

## 操作手順

---

## フォルダ構成例

```
TeamsTranscriptCleaner/
├── ui_components/         # 画面入出力層（Streamlit等）
├── processing/            # 業務処理層（CSVパース・API連携等）
├── transcriptdata/        # サンプルデータ（テキスト・CSV）
├── requirements.txt       # 必要パッケージ
└──  README.md
```

---

## 要件整理

### 基本要件

- 入力：トランスクリプト（テキスト）、訂正単語集（CSV）
- 出力：訂正済み議事録
- UI：ファイルアップロード、訂正実行、結果表示・ダウンロード
- 訂正方法：OpenAI API ＋単語集
- セットアップ・実行手順・API キー設定方法・サンプルデータ利用方法も含めること

### モジュール要件

- UI 処理と業務ロジックの分離
- モジュール配置：`ui_components/`と `processing/`の分離
- インターフェース設計：明確なデータ構造定義
- テストコード実装：重要ロジックにはユニットテスト

---

## セットアップ手順

1. 必要なパッケージのインストール
   ```
   pip install -r requirements.txt
   ```
2. OpenAI API キーの設定
   - Windows 環境変数 `OPENAI_API_KEY` に設定してください
3. サンプルデータの利用
   - `transcriptdata/` フォルダ内にサンプルの議事録テキストと誤字脱字 CSV を配置しています。
   - テストや動作確認にご利用ください。

---

## 実行方法

1. Streamlit アプリの起動
   ```
   streamlit run ui_components/app.py
   ```
2. ブラウザで表示される画面から、
   - チェック対象の議事録や誤字脱字一覧を追加して「訂正実行」ボタンを押します。
   - 誤字脱字一覧は CSV 形式で直接編集・追加・変更できます。
   - 「訂正後テキストを訂正前にコピー」ボタンを押すと、訂正後テキストが訂正前にコピーされます。
   - 最終結果は「最終確定ダウンロード」ボタンからダウンロードできます。

---

## UI 詳細要件
- 誤字脱字修正モード
![](image/image_proofreading.png)
- 文法訂正モード
![](image/image_grammar_check.png)
- 要約モード
![](image/image_summary.png)
---

- Streamlit を使用し、画面を左 3 割・右 7 割で分割
- 左側上部に OpenAI モデル選択（コンボボックス、料金のかからない最近の 5 モデルのみ）
- 左側上部にカスタムプロンプト入力欄（デフォルト：漏字脱字訂正優先、日本語文法訂正は次、意思齟齬は禁止）
- 左側に訂正前の議事録（TXT 限定）アップロードボタン
- 左側に誤字脱字一覧表示テキストエリア（CSV 形式表示・編集可、アップロード直後はプレースホルダ表示）
- 左側に誤字脱字一覧（CSV 限定）アップロードボタン
- 左側下部に訂正実行ボタン
- 右側上部に訂正前後の内容表示（訂正後は手修正可能なテキストエリア）
- 右側中部に差分表示のチェックボックスを配置し、クリックして下部に詳細差分を表示
- 右側下部の訂正後テキストを右上の訂正前テキスト欄にコピーするボタンを設置
- 右側下部に「最終修正結果をダウンロード」ボタン
- ユーザーが何度も OpenAI に再訂正を依頼できる運用を想定

---

## 工程分解・設計

### 構造設計

- モジュール分割：
  1. `ui_components/`：画面入出力層
     - `ui_components/app.py`：Streamlitアプリケーションのエントリーポイント。UIの構築、ユーザーからの入力処理、結果の表示を行う。
        - ファイルアップロードハンドラ：議事録テキストファイルと誤字脱字一覧CSVファイルのアップロードを処理する。
        - モデル選択 UI：OpenAIモデルを選択するためのUIを提供する。
        - プロンプトカスタマイザ：OpenAI APIへの指示をカスタマイズするためのUIを提供する。
        - 結果表示リーダー：訂正前後のテキストを表示し、差分表示機能を提供する。
  2. `processing/`：業務処理層
     - `processing/csv_parser.py`：CSVファイルを読み込み、誤字脱字リストを解析する。
        - `parse_csv_text()`：CSV形式のテキストから誤字脱字リストを解析し、辞書のリストとして返す。
     - `processing/openai_api.py`：OpenAI APIとの通信を処理し、テキストの訂正を行う。
        - `correct_text()`：OpenAI APIを使用してテキストを訂正し、訂正後のテキストと使用コストを返す。
     - `processing/token_manager.py`：OpenAI APIのトークン数を管理する。
        - `count_tokens()`：テキストのトークン数を概算する。
        - `split_text()`：テキストをトークン数制限に基づいて分割する。
        - `estimate_cost()`：APIリクエストの概算コストを計算する。
        - `get_max_tokens_for_model()`：モデルの最大トークン数を取得する。
     - `processing/api_key_manager.py`：OpenAI APIキーを管理し、APIの使用コストを追跡する。
        - `get_api_key()`：環境変数からAPIキーを取得する。
        - `load_config()`：設定ファイルを読み込む。
        - `update_cost()`：使用コストを更新する。
        - `get_total_cost()`：累計コストを取得する。
        - `reset_cost()`：コスト履歴をリセットする。

---

## 開発ロードマップ

- まず最小限のプロトタイプ（アップロード → 訂正 →DL）
- 差分表示など機能拡張
- UI/UX 改善、保守・運用体制整備
- 複数ユーザー対応

  - ユーザー認証機能の追加
  - ユーザーごとの設定保存
  - 単語集の共有機能
  - 権限管理（管理者/一般ユーザー）
